<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>uploadSplit</title>
<link href="../../../../images/logo-icon.svg" rel="icon" type="image/svg"><script>var pathToRoot = "../../../../";</script>    <script>const storage = localStorage.getItem("dokka-dark-mode")
    if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    } else {
        const savedDarkMode = JSON.parse(storage)
        if(savedDarkMode === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    }
    </script>
<script type="text/javascript" src="../../../../scripts/sourceset_dependencies.js" async></script>
<link href="../../../../styles/style.css" rel="Stylesheet">
<link href="../../../../styles/jetbrains-mono.css" rel="Stylesheet">
<link href="../../../../styles/main.css" rel="Stylesheet">
<link href="../../../../styles/prism.css" rel="Stylesheet">
<link href="../../../../styles/logo-styles.css" rel="Stylesheet">
<script type="text/javascript" src="../../../../scripts/clipboard.js" async></script>
<script type="text/javascript" src="../../../../scripts/navigation-loader.js" async></script>
<script type="text/javascript" src="../../../../scripts/platform-content-handler.js" async></script>
<script type="text/javascript" src="../../../../scripts/main.js" defer></script>
<script type="text/javascript" src="../../../../scripts/prism.js" async></script>
<script type="text/javascript" src="../../../../scripts/symbol-parameters-wrapper_deferred.js" defer></script></head>
<body>
<div class="navigation-wrapper" id="navigation-wrapper">
    <div id="leftToggler"><span class="icon-toggler"></span></div>
    <div class="library-name">
<a href="../../../../index.html">
<span>river</span>            </a>    </div>
    <div>
    </div>
    <div class="pull-right d-flex">
        <div class="filter-section" id="filter-section">
                <button class="platform-tag platform-selector jvm-like" data-active="" data-filter=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main">jvm</button>
        </div>
        <button id="theme-toggle-button"><span id="theme-toggle"></span></button>
        <div id="searchBar"></div>
    </div>
</div>
<div id="container">
    <div id="leftColumn">
        <div id="sideMenu"></div>
    </div>
    <div id="main">
<div class="main-content" data-page-type="member" id="content" pageids="connector-aws-s3::com.river.connector.aws.s3//uploadSplit/software.amazon.awssdk.services.s3.S3AsyncClient#kotlin.String#kotlinx.coroutines.flow.Flow[kotlin.Byte]#kotlin.Int#kotlin.Int#kotlin.Function1[kotlin.Int,kotlin.String]/PointingToDeclaration//926345518">
  <div class="breadcrumbs"><a href="../index.html">connector-aws-s3</a><span class="delimiter">/</span><a href="index.html">com.river.connector.aws.s3</a><span class="delimiter">/</span><span class="current">uploadSplit</span></div>
  <div class="cover ">
    <h1 class="cover"><span>upload</span><wbr><span><span>Split</span></span></h1>
  </div>
  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main"><div class="symbol monospace"><span class="token keyword"></span><span class="token keyword">fun </span><span data-unresolved-link="software.amazon.awssdk.services.s3/S3AsyncClient///PointingToDeclaration/">S3AsyncClient</span><span class="token punctuation">.</span><a href="upload-split.html"><span class="token function">uploadSplit</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">bucket<span class="token operator">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html">String</a><span class="token punctuation">, </span></span><span class="parameter ">upstream<span class="token operator">: </span><span data-unresolved-link="kotlinx.coroutines.flow/Flow///PointingToDeclaration/">Flow</span><span class="token operator">&lt;</span><span class="token keyword"></span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-byte/index.html">Byte</a><span class="token operator">&gt;</span><span class="token punctuation">, </span></span><span class="parameter ">splitEach<span class="token operator">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-int/index.html">Int</a><span class="token operator"> = </span>ONE_MB<span class="token punctuation">, </span></span><span class="parameter ">parallelism<span class="token operator">: </span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-int/index.html">Int</a><span class="token operator"> = </span><span class="token constant">1</span><span class="token punctuation">, </span></span><span class="parameter ">key<span class="token operator">: </span><span class="token punctuation">(</span><span class="token keyword"></span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-int/index.html">Int</a><span class="token punctuation">)</span><span class="token operator"> -&gt; </span><span class="token keyword"></span><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html">String</a></span></span><span class="token punctuation">)</span><span class="token operator">: </span><span data-unresolved-link="kotlinx.coroutines.flow/Flow///PointingToDeclaration/">Flow</span><span class="token operator">&lt;</span><span class="token keyword"></span><span data-unresolved-link="software.amazon.awssdk.services.s3.model/S3Response///PointingToDeclaration/">S3Response</span><span class="token operator">&gt;</span></div><p class="paragraph">This function uploads a file in chunks to an Amazon S3 bucket using the S3AsyncClient. Particularly useful for handling streams of unknown size, since it automatically splits the flow into separate files, allowing for seamless processing and storage.</p><span class="kdoc-tag"><h4 class="">Return</h4><p class="paragraph">A flow of S3Response objects for each uploaded chunk.</p><p class="paragraph">When <a href="upload-split.html">splitEach</a> exceeds 5MB, the function automatically utilizes S3's multipart file upload to prevent retaining large chunks of data in-memory. If it is smaller, the function uses the put object operation for a quicker and more efficient processing.</p><p class="paragraph">Example usage:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val s3Client: S3AsyncClient = ...<br>val bucket = "my-bucket"<br>val byteArrayFlow = flowOf&lt;ByteArray&gt; { ... } // A Flow&lt;ByteArray&gt; containing the byte arrays to upload.<br>val oneMB = 1024 * 1024<br><br>s3Client.uploadSplit(bucket = bucket, upstream = byteArrayFlow, splitEach = oneMB) { part -&gt;<br>    "folder/file-part-$part"<br>}<br>.collect { response -&gt;<br>    println("Uploaded part: ${response.key}")<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></span><h4 class="">Parameters</h4><div class="table"><div class="table-row" data-filterable-current=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main" data-filterable-set=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main"><div class="main-subrow keyValue "><div class=""><span class="inline-flex"><div><u><span><span>bucket</span></span></u></div></span></div><div><div class="title"><p class="paragraph">The S3 bucket to upload the file to.</p></div></div></div></div><div class="table-row" data-filterable-current=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main" data-filterable-set=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main"><div class="main-subrow keyValue "><div class=""><span class="inline-flex"><div><u><span><span>upstream</span></span></u></div></span></div><div><div class="title"><p class="paragraph">A flow of bytes representing the file to be uploaded.</p></div></div></div></div><div class="table-row" data-filterable-current=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main" data-filterable-set=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main"><div class="main-subrow keyValue "><div class=""><span class="inline-flex"><div><u><span>split</span><wbr><span><span>Each</span></span></u></div></span></div><div><div class="title"><p class="paragraph">The size of each chunk to be uploaded, in bytes. Default is 1 MB.</p></div></div></div></div><div class="table-row" data-filterable-current=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main" data-filterable-set=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main"><div class="main-subrow keyValue "><div class=""><span class="inline-flex"><div><u><span><span>parallelism</span></span></u></div></span></div><div><div class="title"><p class="paragraph">The number of parallel uploads to use. Default is 1.</p></div></div></div></div><div class="table-row" data-filterable-current=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main" data-filterable-set=":connector:connector-aws:connector-aws-s3:dokkaHtmlPartial/main"><div class="main-subrow keyValue "><div class=""><span class="inline-flex"><div><u><span><span>key</span></span></u></div></span></div><div><div class="title"><p class="paragraph">A function that takes an integer (part number) and returns the key of the object in the S3 bucket.</p></div></div></div></div></div></div></div>
</div>
      <div class="footer">
        <span class="go-to-top-icon"><a href="#content" id="go-to-top-link"></a></span><span>Â© 2023 Copyright</span><span class="pull-right"><span>Generated by </span><a href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span>
      </div>
    </div>
</div>
</body>
</html>

